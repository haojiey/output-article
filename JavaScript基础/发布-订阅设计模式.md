## å‰è¨€

å¤§å®¶å¥½ï¼Œä»Šå¤©ç®€å•å®ç°ä¸€ä¸ª**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**ï¼Œç›¸ä¿¡å¤§å®¶å¯¹è¿™ä¸ªæ¨¡å¼éƒ½ä¸é™Œç”Ÿï¼Œæˆ–å¤šæˆ–å°‘ä¹Ÿéƒ½è§è¿‡æˆ–è€…å¬è¿‡ï¼Œæ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨åˆ°çš„åœ°æ–¹ä¹Ÿä¸å°‘ï¼Œä¸¾ä¸€ä¸ªå¸¸è§çš„ä¾‹å­**Vueä¸­çš„å“åº”å¼åŸç†**ä¸­ä½¿ç”¨äº†**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**

å¹¶ä¸”å‘¢ï¼Œåœ¨å½“å‰ç¯å¢ƒä¸‹çš„é¢è¯•ä¸­ä¹Ÿä¼šå¸¸è¢«é—®åˆ°ä¸€é“é¢˜

**ä½ ç»å¸¸ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Œæœ‰ä»€ä¹ˆä½œç”¨ï¼Œå¦‚ä½•å®ç°å®ƒï¼Ÿ**

é‚£ä¹ˆä»Šå¤©å°±æ¥èŠèŠ**å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼**

## æ¦‚å¿µ

è¿™å‘¢é‡Œå…ˆè¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**

é¦–å…ˆå‘¢**å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„å‘å¸ƒå’Œè®¢é˜…éƒ½ç”±ç»Ÿä¸€çš„ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒæ¥å¤„ç†**ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ¨¡å¼å‘¢æ˜¯æœ‰ä¸‰éƒ¨åˆ†ç»„æˆçš„

-   å‘å¸ƒè€…ï¼šå°†æ¶ˆæ¯äº‹ä»¶å‘å¸ƒåˆ°è°ƒåº¦ä¸­å¿ƒ
-   è®¢é˜…è€…ï¼š æŠŠè‡ªå·±æƒ³å…³æ³¨çš„æ¶ˆæ¯äº‹ä»¶ï¼Œæ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ
-   è°ƒåº¦ä¸­å¿ƒï¼šå¤„ç†äº‹ä»¶æ³¨å†Œä¸å‘å¸ƒ

æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œå°±æ˜¯åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­å®ç°æ›´æ¾çš„è§£è€¦


![1.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95c2cad394ac438ab28dd8814d954f86~tplv-k3u1fbpfcp-watermark.image?)

## å®ç°

å…ˆåˆ—ä¸¾ä¸‹éœ€è¦å®ç°**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**çš„æ€è·¯ï¼Œç›®çš„å‘¢å°±æ˜¯å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼Œ**æ·»åŠ **ã€**åˆ é™¤**ã€**æ´¾å‘**

1.  éœ€è¦ä¸€ä¸ª**äº‹ä»¶å˜é‡**å¯¹è±¡æ¥å­˜å‚¨æ¶ˆæ¯äº‹ä»¶ï¼Œå› ä¸ºå‘¢è®¢é˜…è€…æ˜¯ä¸æ­¢ä¸€ä¸ª
1.  å®šä¹‰ä¸€ä¸ªæ·»åŠ æ–¹æ³•ï¼Œå°†äº‹ä»¶æ·»åŠ åˆ°**äº‹ä»¶å˜é‡**
1.  å®šä¹‰ä¸€ä¸ªåˆ é™¤æ–¹æ³•ï¼Œå°†äº‹ä»¶äº**äº‹ä»¶å˜é‡**ä¸­åˆ é™¤
1.  å®šä¹‰ä¸€ä¸ªæ´¾å‘æ–¹æ³•ï¼Œè°ƒç”¨**äº‹ä»¶å˜é‡**ä¸­çš„äº‹ä»¶

é‚£æˆ‘ä»¬æ¥æ ¹æ®ä¸Šè¿°å››æ¡å†…å®¹å…ˆæ¥å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ¶å­

```
class EventSubscription{
 Â  Â constructor(){
 Â  Â  Â  Â // äº‹ä»¶å˜é‡å¯¹è±¡
 Â  Â  Â  Â this.eventVarObject = {};
 Â   }
â€‹
 Â  Â // äº‹ä»¶æ·»åŠ æ–¹æ³•
 Â  Â addEventFun(){}
â€‹
 Â  Â // äº‹ä»¶åˆ é™¤æ–¹æ³•
 Â  Â deleteEventFun(){}
â€‹
 Â  Â // æ´¾å‘æ–¹æ³•
 Â  Â emitEventFun(){}
}
```

* * *

ç»§ç»­æ¥è¯¦ç»†åˆ†ææ¯ä¸€ä¸ªæ–¹æ³•éœ€è¦åšä»€ä¹ˆäº‹æƒ…

**addEventFun**

`addEventFun`äº‹ä»¶æ·»åŠ æ–¹æ³•

-   æ·»åŠ æ¶ˆæ¯äº‹ä»¶æ˜¯éœ€è¦ä¸€ä¸ª**äº‹ä»¶å**çš„ï¼Œä»¥åŠæ¶ˆæ¯äº‹ä»¶çš„**äº‹ä»¶å›è°ƒå‡½æ•°**
-   éœ€è¦å°†æ¶ˆæ¯äº‹ä»¶æ·»åŠ åˆ°**äº‹ä»¶å˜é‡**ä¸­ï¼Œå¹¶ä¸”ä¸æ­¢ä¸€ä¸ªå˜é‡
-   æ·»åŠ äº‹ä»¶å˜é‡æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨å½“å‰äº‹ä»¶ï¼Œåšä¸åŒçš„å¤„ç†

é‚£æˆ‘ä»¬æ¥ç»§ç»­ä¼˜åŒ–`addEventFun`æ–¹æ³•

```
/**
 * äº‹ä»¶æ·»åŠ æ–¹æ³•
 * @param {'*'} name äº‹ä»¶å
 * @param {*} callback äº‹ä»¶å›è°ƒå‡½æ•°
 */
addEventFun(name, callback) {
 Â // åˆ¤æ–­äº‹ä»¶å˜é‡ä¸­æ˜¯å¦æœ‰å½“å‰äº‹ä»¶, å¦‚æœæ²¡æœ‰çš„è¯åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„
 Â if (!this.eventVarObject[name]) this.eventVarObject[name] = [];
 Â // å¦‚æœå­˜åœ¨ï¼Œé‚£å°±æ˜¯è¯´æ˜è¯¥äº‹ä»¶å¤šä¸ªè®¢é˜…è€…ï¼Œç»§ç»­å¾€åpush
 Â this.eventVarObject[name].push(callback);
}
```

* * *

**deleteEventFun**

`deleteEventFun`äº‹ä»¶åˆ é™¤æ–¹æ³•

-   åˆ é™¤æ¶ˆæ¯äº‹ä»¶æ˜¯éœ€è¦ä¸€ä¸ª**äº‹ä»¶å**çš„ï¼Œä»¥åŠæ¶ˆæ¯äº‹ä»¶çš„**äº‹ä»¶å›è°ƒå‡½æ•°**
-   **äº‹ä»¶å˜é‡**ä¸­ï¼Œå¯¹åº”çš„**äº‹ä»¶å›è°ƒå‡½æ•°**ä¸æ­¢ä¸€ä¸ªï¼Œéœ€è¦å¯¹ç¬¦åˆæ¡ä»¶çš„åˆ é™¤ï¼Œä»…åˆ é™¤è¿™ä¸ªcallback
-   å¦‚æœ**äº‹ä»¶å›è°ƒå‡½æ•°**ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥åˆ é™¤äº‹ä»¶

é‚£æˆ‘ä»¬æ¥ç»§ç»­ä¼˜åŒ–`deleteEventFun`æ–¹æ³•

```
/**
 * äº‹ä»¶åˆ é™¤æ–¹æ³•
 * @param {*} name äº‹ä»¶å
 * @param {*} callback äº‹ä»¶å›è°ƒå‡½æ•°
 */
function deleteEventFun(name, callback) {
 Â // äº‹ä»¶å›è°ƒå‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ é™¤ç›¸åº”æ•´ä¸ªäº‹ä»¶
 Â if (!callback){
 Â  Â  Â delete this.eventVarObject[name];
 Â  Â  Â return
  };
â€‹
 Â // éœ€è¦å¯¹ç¬¦åˆæ¡ä»¶çš„åˆ é™¤
 Â const index = this.eventVarObject[name].findIndex((item) => item == callback);
 Â this.eventVarObject[name].splice(index, 1);
}
```

* * *

**emitEventFun**

`emitEventFun`äº‹ä»¶æ´¾å‘æ–¹æ³•

-   äº‹ä»¶æ´¾å‘æ–¹æ³•åªéœ€è¦**äº‹ä»¶å**ï¼Œç¡®å®šæ˜¯å“ªä¸ªäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ä¼ é€’**å‚æ•°**
-   å°†**äº‹ä»¶å˜é‡**ä¸­ï¼Œå¯¹åº”çš„**äº‹ä»¶å›è°ƒå‡½æ•°**ä¾æ¬¡æ‰§è¡Œ

é‚£æˆ‘ä»¬æ¥ç»§ç»­ä¼˜åŒ–`emitEventFun`æ–¹æ³•

```
/**
 * æ´¾å‘æ–¹æ³•
 * @param {*} name äº‹ä»¶å
 * @param {*} data å‚æ•°
 */
function emitEventFun(name, data) {
 Â // ç¡®è®¤äº‹ä»¶æ˜¯å¦è®¢é˜…
 Â if (!this.eventVarObject[name]) return;
â€‹
 Â // ä¾æ¬¡æ‰§è¡Œäº‹ä»¶å›è°ƒå‡½æ•°
 Â this.eventVarObject[name].forEach((callback) => {
 Â  Â callback(...data);
  });
}
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ•´ä¸ª**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**çš„åŠŸèƒ½å·²ç»åŸºæœ¬å®ç°ï¼Œè¿˜ç¼ºå°‘**ä¸€äº›é”™è¯¯é€»è¾‘çš„å¤„ç†**ï¼Œåœ¨è¿™æˆ‘å°±ä¸æ·»åŠ äº†

**å®Œæ•´ä»£ç **

```
class EventSubscription {
 Â constructor() {
 Â  Â // äº‹ä»¶å˜é‡å¯¹è±¡
 Â  Â this.eventVarObject = {};
  }
â€‹
 Â /**
 Â  * äº‹ä»¶æ·»åŠ æ–¹æ³•
 Â  * @param {'*'} name äº‹ä»¶å
 Â  * @param {*} callback äº‹ä»¶å›è°ƒå‡½æ•°
 Â  */
 Â addEventFun(name, callback) {
 Â  Â // åˆ¤æ–­äº‹ä»¶å˜é‡ä¸­æ˜¯å¦æœ‰å½“å‰äº‹ä»¶, å¦‚æœæ²¡æœ‰çš„è¯åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„
 Â  Â if (!this.eventVarObject[name]) this.eventVarObject[name] = [];
 Â  Â // å¦‚æœå­˜åœ¨ï¼Œé‚£å°±æ˜¯è¯´æ˜è¯¥äº‹ä»¶å¤šä¸ªè®¢é˜…è€…ï¼Œç»§ç»­å¾€åpush
 Â  Â this.eventVarObject[name].push(callback);
  }
â€‹
 Â /**
 Â  * äº‹ä»¶åˆ é™¤æ–¹æ³•
 Â  * @param {'*'} name äº‹ä»¶å
 Â  * @param {*} callback äº‹ä»¶å›è°ƒå‡½æ•°
 Â  */
 Â deleteEventFun(name, callback) {
 Â  Â // äº‹ä»¶å›è°ƒå‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ é™¤ç›¸åº”æ•´æ”¹äº‹ä»¶
 Â  Â if (!callback){
 Â  Â  Â  Â delete this.eventVarObject[name];
 Â  Â  Â  Â return
 Â   };
â€‹
 Â  Â // éœ€è¦å¯¹ç¬¦åˆæ¡ä»¶çš„åˆ é™¤
 Â  Â const index = this.eventVarObject[name].findIndex(
 Â  Â   (item) => item == callback
 Â   );
 Â  Â this.eventVarObject[name].splice(index, 1);
  }
â€‹
 Â /**
 Â  * æ´¾å‘æ–¹æ³•
 Â  * @param {*} name äº‹ä»¶å
 Â  * @param {*} data å‚æ•°
 Â  */
 Â emitEventFun(name, data) {
 Â  Â // ç¡®è®¤äº‹ä»¶æ˜¯å¦è®¢é˜…
 Â  Â if (!this.eventVarObject[name]) return;
â€‹
 Â  Â // ä¾æ¬¡æ‰§è¡Œäº‹ä»¶å›è°ƒå‡½æ•°
 Â  Â this.eventVarObject[name].forEach((callback) => {
 Â  Â  Â callback(...data);
 Â   });
  }
}
```

é‚£æœ€åå‘¢ï¼Œæ¥ä¸ªdemoæ¥æµ‹è¯•ä¸‹æ˜¯å¦æ­£ç¡®

```
const eventSubscription = new EventSubscription();
â€‹
function test1(params) {
 Â console.log("æµ‹è¯•test1:", params);
}
function test2(params) {
 Â console.log("æµ‹è¯•test2:", params);
}
â€‹
// æ·»åŠ è®¢é˜…å†…å®¹
eventSubscription.addEventFun('test', test1);
eventSubscription.addEventFun('test', test2);
console.log(eventSubscription)
// è¾“å‡ºç»“æœ
// EventSubscription {
// Â  Â  eventVarObject: { test: [ [Function: test1], [Function: test2] ] }
// }
â€‹
// æ´¾å‘è®¢é˜…äº‹ä»¶
eventSubscription.emitEventFun('test', 'testsäº‹ä»¶è§¦å‘')
// è¾“å‡ºç»“æœ
// æµ‹è¯•test1: testsäº‹ä»¶è§¦å‘
// æµ‹è¯•test2: testsäº‹ä»¶è§¦å‘
â€‹
// åˆ é™¤è®¢é˜…äº‹ä»¶
eventSubscription.deleteEventFun('test', test2)
console.log(eventSubscription)
// è¾“å‡ºç»“æœ
// EventSubscription { eventVarObject: { test: [ [Function: test1] ] } }
â€‹
eventSubscription.deleteEventFun('test')
console.log(eventSubscription)
// è¾“å‡ºç»“æœ
// EventSubscription { eventVarObject: {} }
```

## ç»“è¯­

**å› ä¸ºå‘¢ï¼Œæˆ‘åœ¨å‚åŠ æ˜é‡‘æ—¥æ–°è®¡åˆ’æ´»åŠ¨ï¼Œæ‰€ä»¥æ¥è¯·ä¸ªèµï¼Œå¦‚æœæ„Ÿè§‰æ­¤æ–‡ç¨å¾®æœ‰äº›å¸®åŠ©çš„è¯ï¼Œè¯·ä¸åç‚¹ä¸ªèµğŸ¥ºğŸ¥ºğŸ¥ºï¼Œå¸®æˆ‘åŠ ä¸ªæ²¹**

**å¼€å¯æ˜é‡‘æˆé•¿ä¹‹æ—…ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’ Â· 2 æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬ 7 å¤©ï¼Œ[ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…](https://juejin.cn/post/7194721470063312933)**
